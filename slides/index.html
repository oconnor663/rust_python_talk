<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <title>reveal.js</title>

        <link rel="stylesheet" href="dist/reset.css">
        <link rel="stylesheet" href="dist/reveal.css">
        <link rel="stylesheet" href="dist/theme/solarized.css">

        <!-- Theme used for syntax highlighted code -->
        <link rel="stylesheet" href="plugin/highlight/solarized-light.css">

        <!-- https://fonts.google.com/selection/embed -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

        <style>
        .hljs-ln-numbers {
            display: none;
        }

        div.columns {
            display: flex;
            flex-direction: row;
            justify-content: space-evenly;
            align-items: center;
            width: 100vw;
            height: 100vh;
        }

        div.rows {
            display: flex;
            flex-direction: column;
            justify-content: space-evenly;
            align-items: center;
            width: 100vw;
            height: 100vh;
        }

        pre.terminal {
            background-color: #eee8d5;
            padding: 20px;
            border-radius: 20px;
            font-size: 30pt;
        }

        code.scrollable {
            box-sizing: border-box;
            font-size: 40pt;
            height: 100vh;
        }

        li {
            margin: 20px;
        }
        .fire {
            /* https://cssdeck.com/blog/create-a-burning-text-effect-with-css3/ */
            text-shadow: 0px -2px 4px #fff, 0px -2px 10px #FF3, 0px -10px 20px #F90, 0px -20px 40px #C33;
        }

        </style>
    </head>
    <body>
        <div class="reveal">
            <div class="slides">


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<div style="text-align: left">

<p>We're not here to talk about about:</p>

<ul>
<li><span class="fire">blazing</span> speed</li>
<li>embedded</li>
<li>Cargo</li>
</ul>

<br>
<br>
<p>We're here to talk about:</p>

<ul>
<li>enums</li>
<li>destructors</li>
<li>aliasing</li>
</ul>

</div>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<h1>enums</h1>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 30pt" class="hljs python" data-trim><script type="text/template">
import sys

def main():
    if len(sys.argv) > 1:
        output = ScreamingOutput(sys.argv[1])
    else:
        output = ScreamingOutput()

    output.write("hello world\n")

class ScreamingOutput:
    def __init__(self, path=None):
        if path is not None:
            self.file = open(path, "w")
        else:
            self.file = None

    def write(self, string):
        all_caps = string.upper()
        if self.file:
            return self.file.write(all_caps)
        else:
            return sys.stdout.write(all_caps)

main()
</script></code></pre>

<pre class="terminal">
$ python3 scream.py
HELLO WORLD

$ python3 scream.py /tmp/out
$ cat /tmp/out
HELLO WORLD
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<pre><code class="hljs python scrollable" data-trim data-line-numbers="3-9|12-16|18-23"><script type="text/template">
import sys

def main():
    if len(sys.argv) > 1:
        output = ScreamingOutput(sys.argv[1])
    else:
        output = ScreamingOutput()

    output.write("hello world\n")

class ScreamingOutput:
    def __init__(self, path=None):
        if path is not None:
            self.file = open(path, "w")
        else:
            self.file = None

    def write(self, string):
        all_caps = string.upper()
        if self.file:
            return self.file.write(all_caps)
        else:
            return sys.stdout.write(all_caps)

main()
</script></code></pre>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 20pt" class="hljs rust" data-trim><script type="text/template">
use std::io::{stdout, Result, Write};

fn main() -> Result<()> {
    let path = std::env::args().nth(1);
    let mut output = ScreamingOutput::new(path.as_deref())?;
    output.write("hello world\n")?;
    Ok(())
}

enum ScreamingOutput {
    File { file: std::fs::File },
    Stdout,
}

impl ScreamingOutput {
    fn new(maybe_path: Option<&str>) -> Result<ScreamingOutput> {
        match maybe_path {
            Some(path) => {
                let file = std::fs::File::create(path)?;
                Ok(ScreamingOutput::File { file })
            }
            None => Ok(ScreamingOutput::Stdout),
        }
    }

    fn write(&mut self, string: &str) -> Result<()> {
        let all_caps = string.to_uppercase();
        match self {
            ScreamingOutput::File { file } => {
                file.write_all(all_caps.as_bytes())
            }
            ScreamingOutput::Stdout => {
                stdout().write_all(all_caps.as_bytes())
            }
        }
    }
}
</script></code></pre>

<pre class="terminal">
$ cargo run -q
HELLO WORLD

$ cargo run -q /tmp/out
$ cat /tmp/out
HELLO WORLD
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<pre><code class="hljs rust scrollable" data-trim data-line-numbers="4-6|10-13|16-24|26-36"><script type="text/template">
use std::io::{stdout, Result, Write};

fn main() -> Result<()> {
    let path = std::env::args().nth(1);
    let mut output = ScreamingOutput::new(path.as_deref())?;
    output.write("hello world\n")?;
    Ok(())
}

enum ScreamingOutput {
    File { file: std::fs::File },
    Stdout,
}

impl ScreamingOutput {
    fn new(maybe_path: Option<&str>) -> Result<ScreamingOutput> {
        match maybe_path {
            Some(path) => {
                let file = std::fs::File::create(path)?;
                Ok(ScreamingOutput::File { file })
            }
            None => Ok(ScreamingOutput::Stdout),
        }
    }

    fn write(&mut self, string: &str) -> Result<()> {
        let all_caps = string.to_uppercase();
        match self {
            ScreamingOutput::File { file } => {
                file.write_all(all_caps.as_bytes())
            }
            ScreamingOutput::Stdout => {
                stdout().write_all(all_caps.as_bytes())
            }
        }
    }
}
</script></code></pre>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<pre><code style="font-size: 30pt" class="hljs diff" data-trim><script type="text/template">
diff --git a/scream.py b/scream.py
index 4da0502..7adbfc0 100644
--- a/scream.py
+++ b/scream.py
@@ -11,8 +11,5 @@ def main():
 class ScreamingOutput:
     def __init__(self, path=None):
-        if path is not None:
             self.file = open(path, "w")
-        else:
-            self.file = None
</script></code></pre>

<pre class="terminal">
$ python scream.py
Traceback (most recent call last):
  File "/home/jacko/why_rust/scream.py", line 22, in <module>
    main()
  File "/home/jacko/why_rust/scream.py", line 7, in main
    output = ScreamingOutput()
             ^^^^^^^^^^^^^^^^^
  File "/home/jacko/why_rust/scream.py", line 13, in __init__
    self.file = open(path, "w")
                ^^^^^^^^^^^^^^^
TypeError: expected str, bytes or os.PathLike object, not NoneType
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<pre><code style="font-size: 30pt" class="hljs diff" data-trim><script type="text/template">
diff --git a/scream.py b/scream.py
index 4da0502..f2a0a56 100644
--- a/scream.py
+++ b/scream.py
@@ -18,8 +18,8 @@ class ScreamingOutput:
     def write(self, string):
         all_caps = string.upper()
         if self.file:
             return self.file.write(all_caps)
         else:
-            return sys.stdout.write(all_caps)
+            return self.file.write(all_caps)
</script></code></pre>

<pre class="terminal">
$ python scream.py
Traceback (most recent call last):
  File "/home/jacko/why_rust/scream.py", line 25, in <module>
    main()
  File "/home/jacko/why_rust/scream.py", line 9, in main
    output.write("hello world\n")
  File "/home/jacko/why_rust/scream.py", line 23, in write
    return self.file.write(all_caps)
           ^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'write'
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<pre><code style="font-size: 25pt" class="hljs diff" data-trim><script type="text/template">
diff --git a/scream.rs/src/main.rs b/scream.rs/src/main.rs
index 562d1c0..fb6a282 100644
--- a/scream.rs/src/main.rs
+++ b/scream.rs/src/main.rs
@@ -16,9 +16,4 @@ impl ScreamingOutput {
     fn new(maybe_path: Option<&str>) -> Result<ScreamingOutput> {
-        match maybe_path {
-            Some(path) => {
-                let file = std::fs::File::create(path)?;
-                Ok(ScreamingOutput::File { file })
-            }
-            None => Ok(ScreamingOutput::Stdout),
-        }
+        let file = std::fs::File::create(maybe_path)?;
+        Ok(ScreamingOutput::File { file })
     }
</script></code></pre>

<pre class="terminal">
$ cargo build
   Compiling scream v0.1.0 (/home/jacko/why_rust/scream.rs)
error[E0277]: the trait bound `Option&lt;&amp;str&gt;: AsRef&lt;Path&gt;` is not satisfied
   --&gt; src/main.rs:17:42
    |
17  |         let file = std::fs::File::create(maybe_path)?;
    |                    --------------------- ^^^^^^^^^^ the trait `AsRef&lt;Path&gt;`
    |                    |                     is not implemented for `Option&lt;&amp;str&gt;`
    |                    |
    |                    required by a bound introduced by this call
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<pre><code style="font-size: 30pt" class="hljs diff" data-trim><script type="text/template">
diff --git a/scream.rs/src/main.rs b/scream.rs/src/main.rs
index 62af897..5fb7e9a 100644
--- a/scream.rs/src/main.rs
+++ b/scream.rs/src/main.rs
@@ -26,12 +26,12 @@ impl ScreamingOutput {
     fn write(&mut self, string: &str) -> Result<()> {
         let all_caps = string.to_uppercase();
         match self {
             ScreamingOutput::File { file } => {
                 file.write_all(all_caps.as_bytes())
             }
             ScreamingOutput::Stdout => {
-                stdout().write_all(all_caps.as_bytes())
+                self.file.write_all(all_caps.as_bytes())
             }
</script></code></pre>

<pre class="terminal">
$ cargo build
   Compiling scream v0.1.0 (/home/jacko/why_rust/scream.rs)
error[E0609]: no field `file` on type `&amp;mut ScreamingOutput`
  --&gt; src/main.rs:33:22
   |
33 |                 self.file.write_all(all_caps.as_bytes())
   |                      ^^^^ unknown field
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<h1>destructors</h1>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<pre><code class="hljs python scrollable" data-trim data-line-numbers="26-28|10"><script type="text/template">
import sys

def main():
    if len(sys.argv) > 1:
        output = ScreamingOutput(sys.argv[1])
    else:
        output = ScreamingOutput()

    output.write("hello world\n")
    output.close()

class ScreamingOutput:
    def __init__(self, path=None):
        if path is not None:
            self.file = open(path, "w")
        else:
            self.file = None

    def write(self, string):
        all_caps = string.upper()
        if self.file:
            return self.file.write(all_caps)
        else:
            return sys.stdout.write(all_caps)

    def close(self):
        if self.file:
            self.file.close()

main()
</script></code></pre>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<pre><code class="hljs python scrollable" data-trim data-line-numbers="9-12"><script type="text/template">
import sys

def main():
    if len(sys.argv) > 1:
        output = ScreamingOutput(sys.argv[1])
    else:
        output = ScreamingOutput()

    try:
        output.write("hello world\n")
    finally:
        output.close()

class ScreamingOutput:
    def __init__(self, path=None):
        if path is not None:
            self.file = open(path, "w")
        else:
            self.file = None

    def write(self, string):
        all_caps = string.upper()
        if self.file:
            return self.file.write(all_caps)
        else:
            return sys.stdout.write(all_caps)

    def close(self):
        if self.file:
            self.file.close()

main()
</script></code></pre>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 19pt" class="hljs python" data-trim><script type="text/template">
import sys

def main():
    outputs = open_outputs(sys.argv[1:])
    try:
        for output in outputs:
            output.write("hello world\n")
    finally:
        for output in outputs:
            output.close()

def open_outputs(paths):
    outputs = []
    try:
        for path in paths:
            outputs.append(ScreamingOutput(path))
    except Exception:
        for output in outputs:
            output.close()
        raise
    return outputs

class ScreamingOutput:
    def __init__(self, path=None):
        if path is not None:
            self.file = open(path, "w")
        else:
            self.file = None

    def write(self, string):
        all_caps = string.upper()
        if self.file:
            return self.file.write(all_caps)
        else:
            return sys.stdout.write(all_caps)

    def close(self):
        if self.file:
            self.file.close()

main()
</script></code></pre>

<pre class="terminal">
$ python3 scream.py /tmp/o1 /tmp/o2 /tmp/o3
$ cat /tmp/o1
HELLO WORLD
$ cat /tmp/o2
HELLO WORLD
$ cat /tmp/o3
HELLO WORLD
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<pre><code class="hljs python scrollable" data-trim data-line-numbers="3-10|12-21"><script type="text/template">
import sys

def main():
    outputs = open_outputs(sys.argv[1:])
    try:
        for output in outputs:
            output.write("hello world\n")
    finally:
        for output in outputs:
            output.close()

def open_outputs(paths):
    outputs = []
    try:
        for path in paths:
            outputs.append(ScreamingOutput(path))
    except Exception:
        for output in outputs:
            output.close()
        raise
    return outputs

class ScreamingOutput:
    def __init__(self, path=None):
        if path is not None:
            self.file = open(path, "w")
        else:
            self.file = None

    def write(self, string):
        all_caps = string.upper()
        if self.file:
            return self.file.write(all_caps)
        else:
            return sys.stdout.write(all_caps)

    def close(self):
        if self.file:
            self.file.close()

main()
</script></code></pre>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 17pt" class="hljs rust" data-trim><script type="text/template">
use std::io::{stdout, Result, Write};

fn main() -> Result<()> {
    let paths: Vec<String> = std::env::args().skip(1).collect();
    let mut outputs = open_outputs(&paths)?;
    for output in &mut outputs {
        output.write("hello world\n")?;
    }
    Ok(())
}

fn open_outputs(paths: &[String]) -> Result<Vec<ScreamingOutput>> {
    let mut outputs = Vec::new();
    for path in paths {
        outputs.push(ScreamingOutput::new(Some(path))?);
    }
    Ok(outputs)
}

enum ScreamingOutput {
    File { file: std::fs::File },
    Stdout,
}

impl ScreamingOutput {
    fn new(maybe_path: Option<&str>) -> Result<ScreamingOutput> {
        match maybe_path {
            Some(path) => {
                let file = std::fs::File::create(path)?;
                Ok(ScreamingOutput::File { file })
            }
            None => Ok(ScreamingOutput::Stdout),
        }
    }

    fn write(&mut self, string: &str) -> Result<()> {
        let all_caps = string.to_uppercase();
        match self {
            ScreamingOutput::File { file } => {
                file.write_all(all_caps.as_bytes())
            }
            ScreamingOutput::Stdout => {
                stdout().write_all(all_caps.as_bytes())
            }
        }
    }
}
</script></code></pre>

<pre class="terminal">
$ cargo run -q /tmp/o1 /tmp/o2 /tmp/o3
$ cat /tmp/o1
HELLO WORLD
$ cat /tmp/o2
HELLO WORLD
$ cat /tmp/o3
HELLO WORLD
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<pre><code class="hljs rust scrollable" data-trim data-line-numbers="3-10|12-18"><script type="text/template">
use std::io::{stdout, Result, Write};

fn main() -> Result<()> {
    let paths: Vec<String> = std::env::args().skip(1).collect();
    let mut outputs = open_outputs(&paths)?;
    for output in &mut outputs {
        output.write("hello world\n")?;
    }
    Ok(())
}

fn open_outputs(paths: &[String]) -> Result<Vec<ScreamingOutput>> {
    let mut outputs = Vec::new();
    for path in paths {
        outputs.push(ScreamingOutput::new(Some(path))?);
    }
    Ok(outputs)
}

enum ScreamingOutput {
    File { file: std::fs::File },
    Stdout,
}

impl ScreamingOutput {
    fn new(maybe_path: Option<&str>) -> Result<ScreamingOutput> {
        match maybe_path {
            Some(path) => {
                let file = std::fs::File::create(path)?;
                Ok(ScreamingOutput::File { file })
            }
            None => Ok(ScreamingOutput::Stdout),
        }
    }

    fn write(&mut self, string: &str) -> Result<()> {
        let all_caps = string.to_uppercase();
        match self {
            ScreamingOutput::File { file } => {
                file.write_all(all_caps.as_bytes())
            }
            ScreamingOutput::Stdout => {
                stdout().write_all(all_caps.as_bytes())
            }
        }
    }
}
</script></code></pre>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<h1>aliasing</h1>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 36pt" class="hljs python" data-trim data-line-numbers="|7,10"><script type="text/template">
class Person:
    def __init__(self, foods):
        self.favorite_foods = foods

donuts = ["donuts"]

alice = Person(donuts)
alice.favorite_foods.append("apples")

bob = Person(donuts)
bob.favorite_foods.append("bananas")

print("alice:", alice.favorite_foods);
print("bob:", bob.favorite_foods);
</script></code></pre>

<pre class="terminal">
$ python accidental_sharing.py
alice: ['donuts', 'apples', 'bananas']
  bob: ['donuts', 'apples', 'bananas']
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 36pt" class="hljs rust" data-trim data-line-numbers="|9,14"><script type="text/template">
struct Person {
    favorite_foods: Vec<&'static str>,
}

fn main() {
    let donuts = vec!["donuts"];

    let mut alice = Person {
        favorite_foods: donuts, // value moved here
    };
    alice.favorite_foods.push("apples");

    let mut bob = Person {
        favorite_foods: donuts, // use of moved value: `donuts`
    };
    bob.favorite_foods.push("bananas");

    println!("{:?}", alice.favorite_foods);
    println!("{:?}", bob.favorite_foods);
}
</script></code></pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 36pt" class="hljs rust" data-trim data-line-numbers="|9,15|11-12,17-18"><script type="text/template">
struct Person<'food> {
    favorite_foods: &'food Vec<&'static str>,
}

fn main() {
    let donuts = vec!["donuts"];

    let alice = Person {
        favorite_foods: &donuts,
    };
    // error: cannot borrow `*alice.favorite_foods` as mutable
    alice.favorite_foods.push("apples");

    let bob = Person {
        favorite_foods: &donuts,
    };
    // error: cannot borrow `*bob.favorite_foods` as mutable
    bob.favorite_foods.push("bananas");

    println!("{:?}", alice.favorite_foods);
    println!("{:?}", bob.favorite_foods);
}
</script></code></pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 36pt" class="hljs rust" data-trim data-line-numbers="|8-9,13-14"><script type="text/template">
struct Person<'food> {
    favorite_foods: &'food mut Vec<&'static str>,
}

fn main() {
    let mut donuts = vec!["donuts"];
    let alice = Person {
        // first mutable borrow occurs here
        favorite_foods: &mut donuts,
    };
    alice.favorite_foods.push("apples");
    let bob = Person {
        // error: cannot borrow `donuts` as mutable more than once at a time
        favorite_foods: &mut donuts,
    };
    bob.favorite_foods.push("bananas");

    println!("{:?}", alice.favorite_foods);
    println!("{:?}", bob.favorite_foods);
}
</script></code></pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 36pt" class="hljs python" data-trim data-line-numbers="|10|6-7"><script type="text/template">
class Person:
    def __init__(self, foods):
        self.favorite_foods = foods

    def add_favorites(self, other_person):
        for food in other_person.favorite_foods:
            self.favorite_foods.append(food)

alice = Person(["apples"])
alice.add_favorites(alice)
</script></code></pre>

<pre class="terminal">
$ python aliasing_self.py
â–¯
Killed
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 36pt" class="hljs rust" data-trim data-line-numbers="|17"><script type="text/template">
struct Person {
    favorite_foods: Vec<&'static str>,
}

impl Person {
    fn add_favorites(&mut self, other: &Person) {
        for food in &other.favorite_foods {
            self.favorite_foods.push(food);
        }
    }
}

fn main() {
    let mut alice = Person {
        favorite_foods: vec!["apples"],
    };
    alice.add_favorites(&alice); // error: cannot borrow `alice` as mutable
}
</script></code></pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 40pt" class="hljs python" data-trim><script type="text/template">
functions = []

for i in range(10):
    functions.append(lambda: print(i))

for f in functions:
    f()
</script></code></pre>

<pre class="terminal">
$ python capture.py 
9
9
9
9
9
9
9
9
9
9
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 40pt" class="hljs rust" data-trim><script type="text/template">
fn main() {
    let mut functions = Vec::new();

    for i in 0..10 {
        // error: `i` does not live long enough
        functions.push(|| println!("{i}"));
    }

    for f in functions {
        f();
    }
}
</script></code></pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<h1>mutex</h1>
</div>
</section>


            </div>
        </div>

        <script src="dist/reveal.js"></script>
        <script src="plugin/notes/notes.js"></script>
        <script src="plugin/markdown/markdown.js"></script>
        <script src="plugin/highlight/highlight.js"></script>
        <script>
            Reveal.initialize({
                hash: true,
                transition: "none",
                disableLayout: true,
                plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
            });
        </script>
    </body>
</html>
