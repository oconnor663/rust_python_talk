<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <title>Rust can Compete with Python</title>

        <link rel="stylesheet" href="dist/reset.css">
        <link rel="stylesheet" href="dist/reveal.css">
        <link rel="stylesheet" href="dist/theme/solarized.css">

        <!-- Theme used for syntax highlighted code -->
        <link rel="stylesheet" href="plugin/highlight/solarized-light.css">

        <!-- https://fonts.google.com/selection/embed -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">

        <style>
        body {
            font-family: Ubuntu;
        }

        .hljs-ln-numbers {
            display: none;
        }

        div.columns {
            display: flex;
            flex-direction: row;
            justify-content: space-evenly;
            align-items: center;
            width: 100vw;
            height: 100vh;
        }

        div.rows {
            display: flex;
            flex-direction: column;
            justify-content: space-evenly;
            align-items: center;
            width: 100vw;
            height: 100vh;
        }

        pre.terminal {
            background-color: #eee8d5;
            padding: 20px;
            border-radius: 20px;
            font-size: 30pt;
        }

        code.scrollable {
            box-sizing: border-box;
            font-size: 40pt;
            height: 100vh;
        }

        .underline {
            text-decoration: underline;
        }

        .logos_row {
            display: flex;
            flex-direction: row;
            justify-content: space-evenly;
            align-items: center;
        }

        .logos_row .logo {
            height: 400px;
            max-width: 400px;
            margin: 0 50px;
        }

        .small_logos_row {
            display: flex;
            flex-direction: row;
            justify-content: space-evenly;
            align-items: center;
        }

        .small_logos_row .logo {
            height: 300px;
            max-width: 300px;
            margin: 0 50px;
        }

        p, ul {
            font-size: 50pt;
        }
        li {
            margin-top: 0.2em;
        }
        .strike {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .fire {
            /* https://cssdeck.com/blog/create-a-burning-text-effect-with-css3/ */
            text-shadow: 0px -2px 4px #fff, 0px -2px 10px #FF3, 0px -10px 20px #F90, 0px -20px 40px #C33;
        }

        </style>
    </head>
    <body>
        <div class="reveal">
            <div class="slides">


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<div>
<h1>Rust can Compete with Python</h1>
<p>
How
<span class="underline">enums</span>,
<span class="underline">destructors</span>,
and
<span class="underline">aliasing rules</span>
<br>
help us write clean code and catch bugs
</p>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<div class="logos_row" style="height: 650px">
<img src="The_C_Programming_Language_logo.svg" class="logo">
<img src="ISO_C++_Logo.svg" class="logo">
</div>
<div>
<ul style="width: 475px">
<li><span class="fire">blazing</span> speed</li>
<li>bare metal</li>
<li>memory safety?</li>
</ul>
</div>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<div>
<div class="small_logos_row">
<img src="python-logo-only.svg#svgView(preserveAspectRatio(xMaxYMax))" class="logo">
<img src="Unofficial_JavaScript_logo_2.svg" class="logo">
<img src="Ruby_logo.svg" class="logo">
</div>
<div class="small_logos_row" style="margin-top: 50px">
<img src="gopher.svg" class="logo">
<img src="Java_programming_language_logo.svg" class="logo">
<img src="c_sharp_logo.svg" class="logo">
</div>
</div>
<div>
<ul style="width: 475px">
<li>easy to write</li>
<li>easy to read</li>
<li>catch bugs</li>
</ul>
</div>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<div class="logos_row" style="height: 650px">
<img src="Rust_programming_language_black_logo.svg" class="logo">
</div>
<div>
<ul style="width: 475px">
<li><span class="strike">easy to write</span></li>
<li>easy to read?</li>
<li>catch bugs!</li>
</ul>
</div>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<div>
<h1>Enums</h1>
<h2>no more null pointer mistakes</h2>
</div>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 34pt" class="hljs python" data-trim data-line-numbers="|2"><script type="text/template">
import sys

class ScreamingOutput:
    def __init__(self, path=None):
        if path is not None:
            self.file = open(path, "w")
        else:
            self.file = None

    def write(self, string):
        all_caps = string.upper()
        if self.file is not None:
            self.file.write(all_caps)
        else:
            sys.stdout.write(all_caps)

if len(sys.argv) > 1:
    output = ScreamingOutput(sys.argv[1])
else:
    output = ScreamingOutput()

output.write("hello world\n")
</script></code></pre>

<pre class="terminal">
$ python scream.py
HELLO WORLD

$ python scream.py /tmp/out
$ cat /tmp/out
HELLO WORLD
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<pre><code class="hljs python scrollable" data-trim data-line-numbers="3-8|10-15|17-22"><script type="text/template">
import sys

class ScreamingOutput:
    def __init__(self, path=None):
        if path is not None:
            self.file = open(path, "w")
        else:
            self.file = None

    def write(self, string):
        all_caps = string.upper()
        if self.file is not None:
            self.file.write(all_caps)
        else:
            sys.stdout.write(all_caps)

if len(sys.argv) > 1:
    output = ScreamingOutput(sys.argv[1])
else:
    output = ScreamingOutput()

output.write("hello world\n")
</script></code></pre>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<pre><code style="font-size: 30pt" class="hljs diff" data-trim><script type="text/template">
diff --git a/scream.py b/scream.py
index f478eda..a530d3d 100644
--- a/scream.py
+++ b/scream.py
@@ -4,6 +4,3 @@ class ScreamingOutput:
     def __init__(self, path=None):
-        if path is not None:
-            self.file = open(path, "w")
-        else:
-            self.file = None
+        self.file = open(path, "w")
</script></code></pre>

<pre class="terminal">
$ python scream.py
Traceback (most recent call last):
  File &quot;/home/jacko/why_rust/scream.py&quot;, line 17, in &lt;module&gt;
    output = ScreamingOutput()
             ^^^^^^^^^^^^^^^^^
  File &quot;/home/jacko/why_rust/scream.py&quot;, line 5, in __init__
    self.file = open(path, &quot;w&quot;)
                ^^^^^^^^^^^^^^^
TypeError: expected str, bytes or os.PathLike object, not NoneType
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<pre><code style="font-size: 30pt" class="hljs diff" data-trim><script type="text/template">
diff --git a/scream.py b/scream.py
index f478eda..e116153 100644
--- a/scream.py
+++ b/scream.py
@@ -10,8 +10,5 @@ class ScreamingOutput:
     def write(self, string):
         all_caps = string.upper()
-        if self.file is not None:
-            self.file.write(all_caps)
-        else:
-            sys.stdout.write(all_caps)
+        self.file.write(all_caps)
</script></code></pre>

<pre class="terminal">
$ python scream.py
Traceback (most recent call last):
  File &quot;/home/jacko/why_rust/scream.py&quot;, line 19, in &lt;module&gt;
    output.write(&quot;hello world\n&quot;)
  File &quot;/home/jacko/why_rust/scream.py&quot;, line 12, in write
    self.file.write(all_caps)
    ^^^^^^^^^^^^^^^
AttributeError: &apos;NoneType&apos; object has no attribute &apos;write&apos;
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 21pt" class="hljs rust" data-trim data-line-numbers="2"><script type="text/template">
use std::io::{self, stdout, Write};

enum ScreamingOutput {
    File { file: std::fs::File },
    Stdout,
}

impl ScreamingOutput {
    fn new(maybe_path: Option<&str>) -> io::Result<ScreamingOutput> {
        match maybe_path {
            Some(path) => {
                let file = std::fs::File::create(path)?;
                Ok(ScreamingOutput::File { file })
            }
            None => Ok(ScreamingOutput::Stdout),
        }
    }

    fn write(&mut self, string: &str) -> io::Result<()> {
        let all_caps = string.to_uppercase();
        match self {
            ScreamingOutput::File { file } => {
                file.write_all(all_caps.as_bytes())
            }
            ScreamingOutput::Stdout => {
                stdout().write_all(all_caps.as_bytes())
            }
        }
    }
}

fn main() -> io::Result<()> {
    let path = std::env::args().nth(1);
    let mut output = ScreamingOutput::new(path.as_deref())?;
    output.write("hello world\n")?;
    Ok(())
}
</script></code></pre>

<pre class="terminal">
$ cargo run -q
HELLO WORLD

$ cargo run -q /tmp/out
$ cat /tmp/out
HELLO WORLD
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<pre><code class="hljs rust scrollable" data-trim data-line-numbers="3-6|19-29|9-17"><script type="text/template">
use std::io::{self, stdout, Write};

enum ScreamingOutput {
    File { file: std::fs::File },
    Stdout,
}

impl ScreamingOutput {
    fn new(maybe_path: Option<&str>) -> io::Result<ScreamingOutput> {
        match maybe_path {
            Some(path) => {
                let file = std::fs::File::create(path)?;
                Ok(ScreamingOutput::File { file })
            }
            None => Ok(ScreamingOutput::Stdout),
        }
    }

    fn write(&mut self, string: &str) -> io::Result<()> {
        let all_caps = string.to_uppercase();
        match self {
            ScreamingOutput::File { file } => {
                file.write_all(all_caps.as_bytes())
            }
            ScreamingOutput::Stdout => {
                stdout().write_all(all_caps.as_bytes())
            }
        }
    }
}

fn main() -> io::Result<()> {
    let path = std::env::args().nth(1);
    let mut output = ScreamingOutput::new(path.as_deref())?;
    output.write("hello world\n")?;
    Ok(())
}
</script></code></pre>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<pre><code style="font-size: 26pt" class="hljs diff" data-trim><script type="text/template">
diff --git a/scream.rs/src/main.rs b/scream.rs/src/main.rs
index 94d3414..b8be627 100644
--- a/scream.rs/src/main.rs
+++ b/scream.rs/src/main.rs
@@ -9,9 +9,4 @@ impl ScreamingOutput {
     fn new(maybe_path: Option<&str>) -> io::Result<ScreamingOutput> {
-        match maybe_path {
-            Some(path) => {
-                let file = std::fs::File::create(path)?;
-                Ok(ScreamingOutput::File { file })
-            }
-            None => Ok(ScreamingOutput::Stdout),
-        }
+        let file = std::fs::File::create(maybe_path)?;
+        Ok(ScreamingOutput::File { file })
     }
</script></code></pre>

<pre class="terminal">
$ cargo build -q
error[E0277]: the trait bound `Option&lt;&amp;str&gt;: AsRef&lt;Path&gt;` is not satisfied
   --&gt; src/main.rs:10:42
    |
10  |         let file = std::fs::File::create(maybe_path)?;
    |                    --------------------- ^^^^^^^^^^ the trait `AsRef&lt;Path&gt;`...
    |                    |
    |                    required by a bound introduced by this call
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<pre><code style="font-size: 26pt" class="hljs diff" data-trim><script type="text/template">
diff --git a/scream.rs/src/main.rs b/scream.rs/src/main.rs
index 94d3414..f54689a 100644
--- a/scream.rs/src/main.rs
+++ b/scream.rs/src/main.rs
@@ -19,12 +19,5 @@ impl ScreamingOutput {
     fn write(&mut self, string: &str) -> io::Result<()> {
         let all_caps = string.to_uppercase();
-        match self {
-            ScreamingOutput::File { file } => {
-                file.write_all(all_caps.as_bytes())
-            }
-            ScreamingOutput::Stdout => {
-                stdout().write_all(all_caps.as_bytes())
-            }
-        }
+        self.file.write_all(all_caps.as_bytes())
     }
</script></code></pre>

<pre class="terminal">
$ cargo build -q
error[E0609]: no field `file` on type `&amp;mut ScreamingOutput`
  --&gt; src/main.rs:21:14
   |
21 |         self.file.write_all(all_caps.as_bytes())
   |              ^^^^ unknown field
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<pre><code style="font-size: 26pt" class="hljs diff" data-trim><script type="text/template">
diff --git a/scream.rs/src/main.rs b/scream.rs/src/main.rs
index c420906..3fc1109 100644
--- a/scream.rs/src/main.rs
+++ b/scream.rs/src/main.rs
@@ -3,4 +3,8 @@ use std::io::{self, stdout, Write};
 enum ScreamingOutput {
-    File { file: std::fs::File },
+    File {
+        file: std::fs::File,
+        path: std::path::PathBuf,
+    },
     Stdout,
+    Stderr,
 }
</script></code></pre>

<pre class="terminal" style="font-size: 26pt">
$ cargo build -q
error[E0063]: missing field `path` in initializer of `ScreamingOutput`
  --> src/main.rs:17:20
   |
17 |                 Ok(ScreamingOutput::File { file })
   |                    ^^^^^^^^^^^^^^^^^^^^^ missing `path`

error[E0004]: non-exhaustive patterns: `&mut ScreamingOutput::Stderr` not covered
  --> src/main.rs:25:15
   |
25 |         match self {
   |               ^^^^ pattern `&mut ScreamingOutput::Stderr` not covered
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<div>
<h1>Destructors</h1>
<h2>no more resource leaks</h2>
</div>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<pre><code class="hljs rust scrollable" data-trim data-line-numbers="32-37|34|37|4"><script type="text/template">
use std::io::{self, stdout, Write};

enum ScreamingOutput {
    File { file: std::fs::File },
    Stdout,
}

impl ScreamingOutput {
    fn new(maybe_path: Option<&str>) -> io::Result<ScreamingOutput> {
        match maybe_path {
            Some(path) => {
                let file = std::fs::File::create(path)?;
                Ok(ScreamingOutput::File { file })
            }
            None => Ok(ScreamingOutput::Stdout),
        }
    }

    fn write(&mut self, string: &str) -> io::Result<()> {
        let all_caps = string.to_uppercase();
        match self {
            ScreamingOutput::File { file } => {
                file.write_all(all_caps.as_bytes())
            }
            ScreamingOutput::Stdout => {
                stdout().write_all(all_caps.as_bytes())
            }
        }
    }
}

fn main() -> io::Result<()> {
    let path = std::env::args().nth(1);
    let mut output = ScreamingOutput::new(path.as_deref())?;
    output.write("hello world\n")?;
    Ok(())
}
</script></code></pre>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<pre><code style="font-size: 40pt" class="hljs rust" data-trim><script type="text/template">
use std::fs::File;
use std::io;
use std::os::fd::AsRawFd;

fn look_at_file_descriptors() -> io::Result<()> {
    let file1 = File::open("/dev/null")?;
    let file2 = File::open("/dev/null")?;
    println!("{:?} {:?}", file1.as_raw_fd(), file2.as_raw_fd());
    Ok(())
}

fn main() -> io::Result<()> {
    look_at_file_descriptors()?;
    look_at_file_descriptors()?;
    look_at_file_descriptors()?;
    Ok(())
}
</script></code></pre>

<pre class="terminal" style="font-size: 50pt; position: absolute; bottom: 100px; right: 200px">
$ cargo run -q
3 4
3 4
3 4
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 40pt" class="hljs python" data-trim><script type="text/template">
def look_at_file_descriptors():
    file1 = open("/dev/null")
    file2 = open("/dev/null")
    print(file1.fileno(), file2.fileno())

look_at_file_descriptors()
look_at_file_descriptors()
look_at_file_descriptors()
</script></code></pre>

<div>
<pre class="terminal" style="font-size: 40pt">
$ python look.py
3 4
3 4
3 4
</pre>
<br/>
<pre class="terminal" style="font-size: 40pt">
$ pypy3 look.py
3 4
5 6
7 8
</pre>
<br/>
<pre class="terminal" style="font-size: 40pt">
$ micropython look.py
3 4
5 6
7 8
</pre>
</div>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 40pt" class="hljs python" data-trim data-line-numbers="5-8"><script type="text/template">
def look_at_file_descriptors():
    file1 = open("/dev/null")
    file2 = open("/dev/null")
    print(file1.fileno(), file2.fileno())
    silly_map1 = {"file": file1}
    silly_map2 = {"file": file2}
    silly_map1["other_map"] = silly_map2
    silly_map2["other_map"] = silly_map1

look_at_file_descriptors()
look_at_file_descriptors()
look_at_file_descriptors()
</script></code></pre>

<div>
<pre class="terminal" style="font-size: 40pt">
$ python look.py
3 4
5 6
7 8
</pre>
<br/>
<pre class="terminal" style="font-size: 40pt">
$ pypy3 look.py
3 4
5 6
7 8
</pre>
<br/>
<pre class="terminal" style="font-size: 40pt">
$ micropython look.py
3 4
5 6
7 8
</pre>
</div>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<pre><code class="hljs python scrollable" data-trim data-line-numbers="17-19,27"><script type="text/template">
import sys

class ScreamingOutput:
    def __init__(self, path=None):
        if path is not None:
            self.file = open(path, "w")
        else:
            self.file = None

    def write(self, string):
        all_caps = string.upper()
        if self.file is not None:
            self.file.write(all_caps)
        else:
            sys.stdout.write(all_caps)

    def close(self):
        if self.file is not None:
            self.file.close()

if len(sys.argv) > 1:
    output = ScreamingOutput(sys.argv[1])
else:
    output = ScreamingOutput()

output.write("hello world\n")
output.close()
</script></code></pre>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<pre><code class="hljs python scrollable" data-trim data-line-numbers="26-29"><script type="text/template">
import sys

class ScreamingOutput:
    def __init__(self, path=None):
        if path is not None:
            self.file = open(path, "w")
        else:
            self.file = None

    def write(self, string):
        all_caps = string.upper()
        if self.file is not None:
            self.file.write(all_caps)
        else:
            sys.stdout.write(all_caps)

    def close(self):
        if self.file is not None:
            self.file.close()

if len(sys.argv) > 1:
    output = ScreamingOutput(sys.argv[1])
else:
    output = ScreamingOutput()

try:
    output.write("hello world\n")
finally:
    output.close()
</script></code></pre>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 20pt" class="hljs python" data-trim data-line-numbers="2"><script type="text/template">
import sys

class ScreamingOutput:
    def __init__(self, path=None):
        if path is not None:
            self.file = open(path, "w")
        else:
            self.file = None

    def write(self, string):
        all_caps = string.upper()
        if self.file is not None:
            self.file.write(all_caps)
        else:
            sys.stdout.write(all_caps)

    def close(self):
        if self.file is not None:
            self.file.close()

def open_outputs(paths):
    outputs = []
    try:
        for path in paths:
            outputs.append(ScreamingOutput(path))
        return outputs
    except Exception:
        for output in outputs:
            output.close()
        raise

outputs = open_outputs(sys.argv[1:])
try:
    for output in outputs:
        output.write("hello world\n")
finally:
    for output in outputs:
        output.close()
</script></code></pre>

<pre class="terminal">
$ python scream_many.py /tmp/o1 /tmp/o2 /tmp/o3
$ cat /tmp/o1
HELLO WORLD
$ cat /tmp/o2
HELLO WORLD
$ cat /tmp/o3
HELLO WORLD
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<pre><code class="hljs python scrollable" data-trim data-line-numbers="32-38|21-30"><script type="text/template">
import sys

class ScreamingOutput:
    def __init__(self, path=None):
        if path is not None:
            self.file = open(path, "w")
        else:
            self.file = None

    def write(self, string):
        all_caps = string.upper()
        if self.file is not None:
            self.file.write(all_caps)
        else:
            sys.stdout.write(all_caps)

    def close(self):
        if self.file is not None:
            self.file.close()

def open_outputs(paths):
    outputs = []
    try:
        for path in paths:
            outputs.append(ScreamingOutput(path))
        return outputs
    except Exception:
        for output in outputs:
            output.close()
        raise

outputs = open_outputs(sys.argv[1:])
try:
    for output in outputs:
        output.write("hello world\n")
finally:
    for output in outputs:
        output.close()
</script></code></pre>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 17pt" class="hljs rust" data-trim data-line-numbers="2"><script type="text/template">
use std::io::{self, stdout, Write};

enum ScreamingOutput {
    File { file: std::fs::File },
    Stdout,
}

impl ScreamingOutput {
    fn new(maybe_path: Option<&str>) -> io::Result<ScreamingOutput> {
        match maybe_path {
            Some(path) => {
                let file = std::fs::File::create(path)?;
                Ok(ScreamingOutput::File { file })
            }
            None => Ok(ScreamingOutput::Stdout),
        }
    }

    fn write(&mut self, string: &str) -> io::Result<()> {
        let all_caps = string.to_uppercase();
        match self {
            ScreamingOutput::File { file } => {
                file.write_all(all_caps.as_bytes())
            }
            ScreamingOutput::Stdout => {
                stdout().write_all(all_caps.as_bytes())
            }
        }
    }
}

fn open_outputs(paths: &[String]) -> io::Result<Vec<ScreamingOutput>> {
    let mut outputs = Vec::new();
    for path in paths {
        outputs.push(ScreamingOutput::new(Some(path))?);
    }
    Ok(outputs)
}

fn main() -> io::Result<()> {
    let paths: Vec<String> = std::env::args().skip(1).collect();
    let mut outputs = open_outputs(&paths)?;
    for output in &mut outputs {
        output.write("hello world\n")?;
    }
    Ok(())
}
</script></code></pre>

<pre class="terminal">
$ cargo run -q /tmp/o1 /tmp/o2 /tmp/o3
$ cat /tmp/o1
HELLO WORLD
$ cat /tmp/o2
HELLO WORLD
$ cat /tmp/o3
HELLO WORLD
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<pre><code class="hljs rust scrollable" data-trim data-line-numbers="32-38"><script type="text/template">
use std::io::{self, stdout, Write};

enum ScreamingOutput {
    File { file: std::fs::File },
    Stdout,
}

impl ScreamingOutput {
    fn new(maybe_path: Option<&str>) -> io::Result<ScreamingOutput> {
        match maybe_path {
            Some(path) => {
                let file = std::fs::File::create(path)?;
                Ok(ScreamingOutput::File { file })
            }
            None => Ok(ScreamingOutput::Stdout),
        }
    }

    fn write(&mut self, string: &str) -> io::Result<()> {
        let all_caps = string.to_uppercase();
        match self {
            ScreamingOutput::File { file } => {
                file.write_all(all_caps.as_bytes())
            }
            ScreamingOutput::Stdout => {
                stdout().write_all(all_caps.as_bytes())
            }
        }
    }
}

fn open_outputs(paths: &[String]) -> io::Result<Vec<ScreamingOutput>> {
    let mut outputs = Vec::new();
    for path in paths {
        outputs.push(ScreamingOutput::new(Some(path))?);
    }
    Ok(outputs)
}

fn main() -> io::Result<()> {
    let paths: Vec<String> = std::env::args().skip(1).collect();
    let mut outputs = open_outputs(&paths)?;
    for output in &mut outputs {
        output.write("hello world\n")?;
    }
    Ok(())
}
</script></code></pre>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 40pt" class="hljs rust" data-trim><script type="text/template">
fn add_one_to_smallest(ints: &mut [i32]) {
    let mut smallest_index = 0;
    for next_index in 1..ints.len() {
        if ints[next_index] < ints[smallest_index] {
            smallest_index = next_index;
        }
    }
    ints[smallest_index] += 1;
}
</script></code></pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 40pt" class="hljs rust" data-trim><script type="text/template">
use std::sync::{Mutex, MutexGuard};

fn add_one_to_smallest(ints: &[Mutex<i32>]) {
    let mut smallest_guard: MutexGuard<i32> = ints[0].lock().unwrap();
    for i in 1..ints.len() {
        let next_guard: MutexGuard<i32> = ints[i].lock().unwrap();
        if *next_guard < *smallest_guard {
            smallest_guard = next_guard;
        }
    }
    *smallest_guard += 1;
}
</script></code></pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<pre><code style="font-size: 26pt" class="hljs diff" data-trim><script type="text/template">
diff --git a/add_one_to_smallest/src/lib.rs b/add_one_to_smallest/src/lib.rs
index 4dc6488..0c36788 100644
--- a/add_one_to_smallest/src/lib.rs
+++ b/add_one_to_smallest/src/lib.rs
@@ -7,7 +7,7 @@ fn add_one_to_smallest(ints: &[Mutex<i32>]) {
     for i in 1..ints.len() {
         let next_guard: MutexGuard<i32> = ints[i].lock().unwrap();
         if *next_guard < *smallest_guard {
-            smallest_guard = next_guard;
+            next_guard = smallest_guard;
         }
     }
     *smallest_guard += 1;
</script></code></pre>

<pre class="terminal" style="font-size: 26pt">
$ cargo build -q
error[E0382]: borrow of moved value: `smallest_guard`
  --> src/lib.rs:13:6
   |
7  |     for i in 1..ints.len() {
   |     ---------------------- inside of this loop
...
10 |             next_guard = smallest_guard;
   |                          -------------- value moved here, in previous iteration of loop
...
13 |     *smallest_guard += 1;
   |      ^^^^^^^^^^^^^^ value borrowed here after move
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<pre><code style="font-size: 26pt" class="hljs diff" data-trim><script type="text/template">
diff --git a/add_one_to_smallest/src/lib.rs b/add_one_to_smallest/src/lib.rs
index 4dc6488..6f180c5 100644
--- a/add_one_to_smallest/src/lib.rs
+++ b/add_one_to_smallest/src/lib.rs
@@ -3,9 +3,9 @@
 fn add_one_to_smallest(ints: &[Mutex<i32>]) {
-    let mut smallest_guard: MutexGuard<i32> = ints[0].lock().unwrap();
+    let mut smallest_guard: &mut i32 = &mut *ints[0].lock().unwrap();
     for i in 1..ints.len() {
-        let next_guard: MutexGuard<i32> = ints[i].lock().unwrap();
+        let next_guard: &mut i32 = &mut *ints[i].lock().unwrap();
         if *next_guard < *smallest_guard {
             smallest_guard = next_guard;
         }
</script></code></pre>

<pre class="terminal" style="font-size: 26pt">
$ cargo build -q
error[E0716]: temporary value dropped while borrowed
  --&gt; src/lib.rs:8:42
   |
8  |         let next_guard: &amp;mut i32 = &amp;mut *ints[i].lock().unwrap();
   |                                          ^^^^^^^^^^^^^^^^^^^^^^^ creates a temporary value...
...
12 |     }
   |     - temporary value is freed at the end of this statement
13 |     *smallest_guard += 1;
   |     -------------------- borrow later used here
   |
   = note: consider using a `let` binding to create a longer lived value
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<div>
<h1>Aliasing Rules</h1>
<h2>no more "spooky action at a distance"</h2>
</div>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 36pt" class="hljs python" data-trim data-line-numbers="|7,10"><script type="text/template">
class Person:
    def __init__(self, foods):
        self.favorite_foods = foods

donuts = ["donuts"]

alice = Person(donuts)
alice.favorite_foods.append("apples")

bob = Person(donuts)
bob.favorite_foods.append("bananas")

print("alice:", alice.favorite_foods);
print("  bob:", bob.favorite_foods);
</script></code></pre>

<div style="width: 800px">
<pre class="terminal">
$ python food.py
alice: ['donuts', 'apples', 'bananas']
  bob: ['donuts', 'apples', 'bananas']
</pre>
</div>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 36pt" class="hljs python" data-trim data-line-numbers="7,10"><script type="text/template">
class Person:
    def __init__(self, foods):
        self.favorite_foods = foods

donuts = ["donuts"]

alice = Person(list(donuts))
alice.favorite_foods.append("apples")

bob = Person(list(donuts))
bob.favorite_foods.append("bananas")

print("alice:", alice.favorite_foods);
print("  bob:", bob.favorite_foods);
</script></code></pre>

<div style="width: 800px">
<pre class="terminal" style="width: fit-content">
$ python food.py
alice: ['donuts', 'apples']
  bob: ['donuts', 'bananas']
</pre>
</div>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 36pt" class="hljs rust" data-trim data-line-numbers="|9,14"><script type="text/template">
struct Person {
    favorite_foods: Vec<&'static str>,
}

fn main() {
    let donuts = vec!["donuts"];

    let mut alice = Person {
        favorite_foods: donuts, // value moved here
    };
    alice.favorite_foods.push("apples");

    let mut bob = Person {
        favorite_foods: donuts, // error: use of moved value: `donuts`
    };
    bob.favorite_foods.push("bananas");

    println!("{:?}", alice.favorite_foods);
    println!("{:?}", bob.favorite_foods);
}
</script></code></pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 36pt" class="hljs rust" data-trim data-line-numbers="9,14"><script type="text/template">
struct Person {
    favorite_foods: Vec<&'static str>,
}

fn main() {
    let donuts = vec!["donuts"];

    let mut alice = Person {
        favorite_foods: donuts.clone(),
    };
    alice.favorite_foods.push("apples");

    let mut bob = Person {
        favorite_foods: donuts.clone(),
    };
    bob.favorite_foods.push("bananas");

    println!("{:?}", alice.favorite_foods);
    println!("{:?}", bob.favorite_foods);
}
</script></code></pre>

<pre class="terminal">
$ cargo run -q
["donuts", "apples"]
["donuts", "bananas"]
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 36pt" class="hljs rust" data-trim data-line-numbers="9,15|11-12,17-18"><script type="text/template">
struct Person<'food> {
    favorite_foods: &'food Vec<&'static str>,
}

fn main() {
    let donuts = vec!["donuts"];

    let alice = Person {
        favorite_foods: &donuts,
    };
    // error: cannot borrow `*alice.favorite_foods` as mutable
    alice.favorite_foods.push("apples");

    let bob = Person {
        favorite_foods: &donuts,
    };
    // error: cannot borrow `*bob.favorite_foods` as mutable
    bob.favorite_foods.push("bananas");

    println!("{:?}", alice.favorite_foods);
    println!("{:?}", bob.favorite_foods);
}
</script></code></pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 36pt" class="hljs rust" data-trim data-line-numbers="8-9,13-14"><script type="text/template">
struct Person<'food> {
    favorite_foods: &'food mut Vec<&'static str>,
}

fn main() {
    let mut donuts = vec!["donuts"];
    let alice = Person {
        // first mutable borrow occurs here
        favorite_foods: &mut donuts,
    };
    alice.favorite_foods.push("apples");
    let bob = Person {
        // error: cannot borrow `donuts` as mutable more than once at a time
        favorite_foods: &mut donuts,
    };
    bob.favorite_foods.push("bananas");

    println!("{:?}", alice.favorite_foods);
    println!("{:?}", bob.favorite_foods);
}
</script></code></pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 36pt" class="hljs python" data-trim><script type="text/template">
class Person:
    def __init__(self, foods):
        self.favorite_foods = foods

    def add_favorites(self, other_person):
        for food in other_person.favorite_foods:
            self.favorite_foods.append(food)

alice = Person(["apples"])
alice.add_favorites(alice)
</script></code></pre>

<pre class="terminal">
$ python circular.py
▯
Killed
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 36pt" class="hljs rust" data-trim><script type="text/template">
struct Person {
    favorite_foods: Vec<&'static str>,
}

impl Person {
    fn add_favorites(&mut self, other: &Person) {
        for food in &other.favorite_foods {
            self.favorite_foods.push(food);
        }
    }
}

fn main() {
    let mut alice = Person {
        favorite_foods: vec!["apples"],
    };
    alice.add_favorites(&alice); // error: cannot borrow `alice` as mutable
}
</script></code></pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 40pt" class="hljs python" data-trim><script type="text/template">
functions = []

for i in range(10):
    functions.append(lambda: print(i))

for f in functions:
    f()
</script></code></pre>

<pre class="terminal" style="font-size: 40pt">
$ python capture.py
9
9
9
9
9
9
9
9
9
9
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 40pt" class="hljs rust" data-trim><script type="text/template">
fn main() {
    let mut functions = Vec::new();

    for i in 0..10 {
        // error: `i` does not live long enough
        functions.push(|| println!("{i}"));
    }

    for f in functions {
        f();
    }
}
</script></code></pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 40pt" class="hljs rust" data-trim data-trim data-line-numbers="5"><script type="text/template">
fn main() {
    let mut functions = Vec::new();

    for i in 0..10 {
        functions.push(move || println!("{i}"));
    }

    for f in functions {
        f();
    }
}
</script></code></pre>

<pre class="terminal" style="font-size: 40pt">
$ cargo run -q
0
1
2
3
4
5
6
7
8
9
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows" style="font-size: 40pt">
<pre><code class="hljs rust" style="width: 1400px"><script type="text/template">



fn main() {
    let mut sum = 0;
    (0..100).for_each(|i| {
        sum += i;
    });
    assert_eq!(sum, 4950);
}
</script></code></pre>

<pre class="terminal" style="visibility: hidden" >
$ cargo build -q
error[E0594]: cannot assign to `sum`, as it is a captured variable in a `Fn` closure
 --> src/main.rs:6:9
  |
6 |         sum += i;
  |         ^^^^^^^^ cannot assign
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows" style="font-size: 40pt">
<pre><code class="hljs rust" data-line-numbers="3,7" style="width: 1400px"><script type="text/template">

use rayon::prelude::*;

fn main() {
    let mut sum = 0;
    (0..100).into_par_iter().for_each(|i| {
        sum += i;
    });
    assert_eq!(sum, 4950);
}
</script></code></pre>

<pre class="terminal">
$ cargo build -q
error[E0594]: cannot assign to `sum`, as it is a captured variable in a `Fn` closure
 --> src/main.rs:6:9
  |
6 |         sum += i;
  |         ^^^^^^^^ cannot assign
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows" style="font-size: 40pt">
<pre><code class="hljs rust" data-line-numbers="2,6,8,10" style="width: 1400px"><script type="text/template">
use std::sync::Mutex;
use rayon::prelude::*;

fn main() {
    let sum = Mutex::new(0);
    (0..100).into_par_iter().for_each(|i| {
        *sum.lock().unwrap() += i;
    });
    assert_eq!(*sum.lock().unwrap(), 4950);
}
</script></code></pre>

<pre class="terminal" style="visibility: hidden" >
$ cargo build -q
error[E0594]: cannot assign to `sum`, as it is a captured variable in a `Fn` closure
 --> src/main.rs:6:9
  |
6 |         sum += i;
  |         ^^^^^^^^ cannot assign
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<div class="logos_row">
<img src="Haskell-Logo.svg" class="logo">
<img src="ocaml-logo.svg" class="logo">
<img src="scala-logo.svg" class="logo">
<img src="Racket-logo.svg" class="logo">
</div>
<ul style="width: 1050px">
<li>no mutation</li>
<li>no "spooky action at a distance"</li>
<li>catch bugs</li>
</ul>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<div class="logos_row">
<img src="Rust_programming_language_black_logo.svg" class="logo">
</div>
<ul style="width: 1050px">
<li><span class="strike">no mutation</span> aliasing XOR mutation</li>
<li>no "spooky action at a distance"</li>
<li>catch bugs</li>
</ul>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="rows">
<div>
<h1>Standalone Scripts</h1>
<h2>watch this space</h2>
</div>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 30pt" class="hljs python" data-trim><script type="text/template">
#! /usr/bin/env python3

import argparse

parser = argparse.ArgumentParser()
parser.add_argument("words", nargs="*")
parser.add_argument("-n", action="store_true")

args = parser.parse_args()
print(" ".join(args.words).upper(), end='')
if not args.n:
    print()
</script></code></pre>

<pre class="terminal">
$ ./echo.py hello world
HELLO WORLD
$ ./echo.py hello world -n
HELLO WORLD$ ▯
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 30pt" class="hljs rust" data-trim><script type="text/template">
#!/usr/bin/env rust-script
//! ```cargo
//! [dependencies]
//! clap = { version = "4.2", features = ["derive"] }
//! ```

use clap::Parser;

#[derive(Parser)]
struct Args {
    words: Vec<String>,
    #[arg(short('n'))]
    no_newline: bool,
}

fn main() {
    let args = Args::parse();
    print!("{}", args.words.join(" ").to_uppercase());
    if !args.no_newline {
        println!();
    }
}
</script></code></pre>

<pre class="terminal">
$ cargo install rust-script

$ ./echo.rs hello world
HELLO WORLD
$ ./echo.rs hello world -n
HELLO WORLD$ ▯
</pre>
</div>
</section>


<section><!---------------------------------- SLIDE ----------------------------------------------->
<div class="columns">
<pre><code style="font-size: 30pt" class="hljs rust" data-trim><script type="text/template">
#!/usr/bin/env cargo
---
[package]
edition = "2021"

[dependencies]
clap = { version = "4.2", features = ["derive"] }
---

use clap::Parser;

#[derive(Parser)]
struct Args {
    words: Vec<String>,
    #[arg(short('n'))]
    no_newline: bool,
}

fn main() {
    let args = Args::parse();
    print!("{}", args.words.join(" ").to_uppercase());
    if !args.no_newline {
        println!();
    }
}
</script></code></pre>

<pre class="terminal">
$ ./echo.rs hello world
HELLO WORLD
$ ./echo.rs hello world -n
HELLO WORLD$ ▯
</pre>
</div>
</section>


            </div>
        </div>

        <script src="dist/reveal.js"></script>
        <script src="plugin/notes/notes.js"></script>
        <script src="plugin/markdown/markdown.js"></script>
        <script src="plugin/highlight/highlight.js"></script>
        <script>
            Reveal.initialize({
                hash: true,
                transition: "none",
                disableLayout: true,
                plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
            });
        </script>
    </body>
</html>
